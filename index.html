<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Message Visualizer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #fff;
            font-family: Arial, sans-serif;
        }
        canvas {
            display: block;
        }
    </style>
</head>
<body>
    <script>
        const { ipcRenderer } = require('electron');
        
        // Expose electron to the sketch
        window.electron = { ipcRenderer };
        
        // Listen for control updates
        ipcRenderer.on('update-text-size', (event, size) => {
            window.currentTextSize = size;
        });

        ipcRenderer.on('update-max-highlights', (event, value) => {
            window.maxHighlights = value;
        });

        ipcRenderer.on('update-highlight-duration', (event, value) => {
            window.highlightDuration = value;
        });

        ipcRenderer.on('update-max-messages', (event, value) => {
            window.maxMessages = value;
        });

        ipcRenderer.on('update-message-lifetime', (event, value) => {
            window.messageLifetime = value;
        });

        ipcRenderer.on('update-birth-rate', (event, value) => {
            window.messageInterval = value * 1000; // Convert seconds to milliseconds
            console.log('Updated birth rate:', value, 'seconds (', window.messageInterval, 'ms)');
        });
        
        ipcRenderer.on('update-transition-speed', (event, value) => {
            if (messageManager) {
                messageManager.fontSizeTransitionSpeed = value;
                console.log('Updated transition speed:', value);
            }
        });
        
        ipcRenderer.on('randomize-positions', () => {
            if (messageManager) {
                messageManager.randomizePositions();
                console.log('Randomized positions');
            }
        });
        
        ipcRenderer.on('update-custom-text', (event, customText) => {
            if (messageManager) {
                const sentences = customText.split(/\s*,\s*/).filter(sentence => sentence.length > 0);
                if (sentences.length > 0) {
                    window.customWords = sentences;
                    messageManager.loadCustomWords(window.customWords);
                    console.log('Updated custom sentences:', window.customWords);
                }
            }
        });

        // Set initial values
        window.maxHighlights = 3;
        window.highlightDuration = 3000;
        window.maxMessages = 15;
        window.messageLifetime = 10000;
        window.messageInterval = 1000;
        window.customWords = ["Hello World", "Welcome to the Visualization", "Text Display"];
    </script>
    
    <!-- Color Sheet - Load this first so colors are available to other scripts -->
    <script src="colorSheet.js"></script>
    
    <script src="textClass.js"></script>
    <script src="messageManager.js"></script>
    <script src="sketch.js"></script>
</body>
</html>
